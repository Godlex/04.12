<!doctype html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>–í–æ–ø—Ä–æ—Å –Ω–∞ –î–µ–Ω—å –°–≤—è—Ç–æ–≥–æ –í–∞–ª–µ–Ω—Ç–∏–Ω–∞</title>
  <style>
    :root {
      --bg-start: #ffd1dc;
      --bg-end: #ffe8f0;
      --card: rgba(255, 255, 255, 0.8);
      --text: #5e2b4d;
      --yes: #ff4f87;
      --yes-hover: #ff2f75;
      --no: #6e6e6e;
      --shadow: 0 12px 30px rgba(94, 43, 77, 0.18);
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      min-height: 100vh;
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      color: var(--text);
      background: linear-gradient(135deg, var(--bg-start), var(--bg-end));
      overflow: hidden;
      display: grid;
      place-items: center;
    }

    .hearts {
      position: fixed;
      inset: 0;
      pointer-events: none;
      overflow: hidden;
      z-index: 0;
      contain: layout style paint;
    }

    .heart {
      position: absolute;
      font-size: 1.5rem;
      opacity: 0.22;
      animation: floatAmbient linear infinite;
    }

    .heart.heart-small {
      font-size: 1rem;
      opacity: 0.18;
    }

    .heart.heart-big {
      font-size: 2rem;
      opacity: 0.2;
    }

    @keyframes floatAmbient {
      from {
        transform: translate3d(0, 0, 0) scale(0.8);
        opacity: 0.12;
      }
      50% {
        opacity: 0.35;
      }
      to {
        transform: translate3d(var(--hx, 0px), var(--hy, -90px), 0) scale(1.2);
        opacity: 0;
      }
    }

    .card {
      position: relative;
      z-index: 1;
      width: 100%;
      padding: 2.25rem;
      border-radius: 24px;
      background: var(--card);
      backdrop-filter: blur(8px);
      box-shadow: var(--shadow);
      text-align: center;
      border: 1px solid rgba(255, 255, 255, 0.55);
    }

    h1 {
      margin: 0 0 1rem;
      font-size: clamp(1.5rem, 4vw, 2rem);
      line-height: 1.25;
      letter-spacing: 0.2px;
    }

    .message {
      min-height: 2.2rem;
      margin-bottom: 1.2rem;
      font-size: 1.05rem;
      font-weight: 600;
      color: #c2185b;
      transition: opacity 220ms ease, transform 220ms ease;
      opacity: 0;
      transform: translateY(8px);
    }

    .message.show {
      opacity: 1;
      transform: translateY(0);
    }

    .card-wrapper {
      position: relative;
      z-index: 1;
      width: min(90vw, 520px);
    }

    .photo-ring {
      position: fixed;
      inset: 0;
      pointer-events: none;
      opacity: 0;
      transition: opacity 420ms ease;
      z-index: 0;
    }

    .photo-ring.show {
      opacity: 1;
    }

    .photo-item {
      position: fixed;
      width: 80px;
      height: 80px;
      border-radius: 50%;
      overflow: visible;
      will-change: transform, opacity;
    }

    .photo-item-inner.photo-jump {
      animation: photoPulse 0.55s ease-in-out both;
    }

    @keyframes photoPulse {
      0%   { transform: scale(1); }
      50%  { transform: scale(1.6); }
      100% { transform: scale(1); }
    }

    .effects-canvas {
      position: fixed;
      inset: 0;
      width: 100vw;
      height: 100vh;
      pointer-events: none;
      z-index: 11;
      contain: layout style paint;
    }

    .photo-item-inner {
      position: relative;
      width: 100%;
      height: 100%;
      border-radius: 50%;
      overflow: hidden;
      border: 4px solid #ff95bf;
      box-shadow: 0 12px 28px rgba(194, 24, 91, 0.35);
      background: #fff;
    }

    .photo-item img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }

    .photo-hearts {
      position: absolute;
      left: 50%;
      top: 50%;
      width: 160px;
      height: 160px;
      margin-left: -80px;
      margin-top: -80px;
      pointer-events: none;
    }

    .photo-heart-orbit {
      position: absolute;
      left: 80px;
      top: 80px;
      width: 0;
      height: 0;
      animation: orbitPhoto linear infinite;
    }

    .photo-heart {
      position: absolute;
      font-size: 0.8rem;
      opacity: 0.95;
      left: 0;
      margin-left: -0.45em;
      width: 1em;
      text-align: center;
    }

    .photo-heart-orbit .photo-heart { top: -42px; }
    .photo-heart-orbit.photo-heart-outer .photo-heart { top: -58px; font-size: 0.7rem; }

    @keyframes orbitPhoto {
      from { transform: rotate(0deg); }
      to   { transform: rotate(360deg); }
    }

    .photo-heart-orbit:nth-child(1)  { animation-duration: 4s;   animation-delay: 0s; }
    .photo-heart-orbit:nth-child(2)  { animation-duration: 5s;   animation-delay: -1s; }
    .photo-heart-orbit:nth-child(3)  { animation-duration: 6s;   animation-delay: -2.2s; }
    .photo-heart-orbit:nth-child(4)  { animation-duration: 4.5s; animation-delay: -0.5s; }
    .photo-heart-orbit:nth-child(5)  { animation-duration: 5.5s; animation-delay: -3s; }
    .photo-heart-orbit:nth-child(6)  { animation-duration: 3.8s; animation-delay: -0.8s; }
    .photo-heart-orbit:nth-child(7)  { animation-duration: 5.2s; animation-delay: -2.5s; }
    .photo-heart-orbit:nth-child(8)  { animation-duration: 4.8s; animation-delay: -1.8s; }
    .photo-heart-orbit:nth-child(9)  { animation-duration: 6.2s; animation-delay: -3.5s; }
    .photo-heart-orbit:nth-child(10) { animation-duration: 4.2s; animation-delay: -0.3s; }

    @keyframes flyLeftToRight {
      0%   { left: -100px; opacity: 0; }
      5%   { opacity: 1; }
      95%  { opacity: 1; }
      100% { left: 100vw; opacity: 0; }
    }
    @keyframes flyRightToLeft {
      0%   { left: 100vw; opacity: 0; }
      5%   { opacity: 1; }
      95%  { opacity: 1; }
      100% { left: -100px; opacity: 0; }
    }
    @keyframes flyTopToBottom {
      0%   { top: -100px; opacity: 0; }
      5%   { opacity: 1; }
      95%  { opacity: 1; }
      100% { top: 100vh; opacity: 0; }
    }
    @keyframes flyBottomToTop {
      0%   { top: 100vh; opacity: 0; }
      5%   { opacity: 1; }
      95%  { opacity: 1; }
      100% { top: -100px; opacity: 0; }
    }
    @keyframes flyTopLeftToBottomRight {
      0%   { left: -100px; top: -100px; opacity: 0; }
      5%   { opacity: 1; }
      95%  { opacity: 1; }
      100% { left: 100vw; top: 100vh; opacity: 0; }
    }
    @keyframes flyTopRightToBottomLeft {
      0%   { left: 100vw; top: -100px; opacity: 0; }
      5%   { opacity: 1; }
      95%  { opacity: 1; }
      100% { left: -100px; top: 100vh; opacity: 0; }
    }
    @keyframes flyBottomLeftToTopRight {
      0%   { left: -100px; top: 100vh; opacity: 0; }
      5%   { opacity: 1; }
      95%  { opacity: 1; }
      100% { left: 100vw; top: -100px; opacity: 0; }
    }
    @keyframes flyBottomRightToTopLeft {
      0%   { left: 100vw; top: 100vh; opacity: 0; }
      5%   { opacity: 1; }
      95%  { opacity: 1; }
      100% { left: -100px; top: -100px; opacity: 0; }
    }

    .compliments-zone {
      position: relative;
      min-height: 200px;
      margin-bottom: 0.6rem;
      padding: 2rem 1.2rem;
      border-radius: 22px;
      background: rgba(255, 255, 255, 0.55);
      border: 1px solid rgba(255, 255, 255, 0.8);
      overflow: visible;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .compliments-zone::before {
      content: "";
      position: absolute;
      top: 0.4rem;
      right: 0.75rem;
      pointer-events: none;
    }

    .compliments-zone .message {
      margin: 0;
      max-width: 86%;
      position: relative;
      z-index: 1;
      background: rgba(255, 255, 255, 0.78);
      border: 1px solid rgba(255, 79, 135, 0.2);
      border-radius: 16px;
      padding: 0.75rem 1rem;
      box-shadow: 0 8px 18px rgba(94, 43, 77, 0.08);
    }

    .buttons {
      display: flex;
      justify-content: center;
      gap: 0.9rem;
      position: relative;
      min-height: 54px;
    }

    button {
      border: none;
      outline: none;
      cursor: pointer;
      font-size: 1rem;
      font-weight: 700;
      letter-spacing: 0.3px;
      padding: 0.85rem 1.7rem;
      border-radius: 999px;
      transition: transform 120ms ease, box-shadow 180ms ease, background 180ms ease;
      box-shadow: 0 8px 16px rgba(0, 0, 0, 0.12);
      user-select: none;
    }

    button:focus {
      outline: none;
      border: none;
    }

    button:active {
      transform: scale(0.98);
    }

    #yesBtn {
      background: var(--yes);
      color: #fff;
    }

    #yesBtn:hover {
      background: var(--yes-hover);
      box-shadow: 0 10px 22px rgba(255, 79, 135, 0.35);
    }

    #yesBtn.bigger {
      transition: transform 0.4s cubic-bezier(0.34, 1.56, 0.64, 1), 
                  font-size 0.4s ease, 
                  padding 0.4s ease,
                  box-shadow 0.4s ease;
    }

    #yesBtn2 {
      position: fixed;
      background: var(--yes);
      color: #fff;
      border: none;
      outline: none;
      cursor: pointer;
      font-size: 1rem;
      font-weight: 700;
      letter-spacing: 0.3px;
      padding: 0.85rem 1.7rem;
      border-radius: 999px;
      box-shadow: 0 8px 16px rgba(0, 0, 0, 0.12);
      user-select: none;
      z-index: 5;
      clip-path: inset(0 100% 0 0);
      opacity: 0;
      visibility: hidden;
      pointer-events: none;
      transition: clip-path 400ms cubic-bezier(0.4, 0, 0.2, 1), opacity 400ms ease, visibility 0s 400ms;
      overflow: hidden;
    }

    #yesBtn2.show {
      clip-path: inset(0 0 0 0);
      opacity: 1;
      visibility: visible;
      pointer-events: auto;
      transition: clip-path 400ms cubic-bezier(0.4, 0, 0.2, 1), opacity 400ms ease, visibility 0s 0s;
    }

    #yesBtn2:hover {
      background: var(--yes-hover);
      box-shadow: 0 10px 22px rgba(255, 79, 135, 0.35);
    }

    #yesBtn2:active {
      transform: scale(0.98);
    }

    #noBtn {
      position: fixed;
      left: 0;
      top: 0;
      background: var(--no);
      color: #fff;
      transition: clip-path 400ms cubic-bezier(0.4, 0, 0.2, 1), opacity 400ms ease;
      z-index: 5;
      visibility: hidden;
      clip-path: inset(0 0 0 0);
      overflow: hidden;
    }

    #noBtn.teleport-out {
      clip-path: inset(0 0 0 100%);
      opacity: 0;
      pointer-events: none;
    }

    #noBtn.teleport-in {
      clip-path: inset(0 0 0 0);
      opacity: 1;
      pointer-events: auto;
    }

    /* Confetti and burst particles are rendered via canvas for performance. */

    .popup {
      position: fixed;
      top: 30px;
      left: 50%;
      transform: translateX(-50%) scale(0.8);
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(12px);
      padding: 2rem 2.5rem;
      border-radius: 20px;
      box-shadow: 0 20px 60px rgba(94, 43, 77, 0.3);
      z-index: 100;
      text-align: center;
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--text);
      border: 2px solid rgba(255, 79, 135, 0.3);
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.4s ease, transform 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
    }

    .popup.show {
      opacity: 1;
      transform: translateX(-50%) scale(1);
      pointer-events: auto;
    }

    .popup::before {
      content: "üíï";
      display: block;
      font-size: 2.5rem;
      margin-bottom: 0.5rem;
    }
  </style>
</head>
<body>
  <div class="hearts" id="heartsLayer" aria-hidden="true"></div>
  <canvas class="effects-canvas" id="effectsCanvas" aria-hidden="true"></canvas>

  <div class="card-wrapper">
    <div class="photo-ring" id="photoRing" aria-hidden="true"></div>
    <main class="card">
      <h1>–ë—É–¥–µ—à—å –º–æ–µ–π –í–∞–ª–µ–Ω—Ç–∏–Ω–∫–æ–π?</h1>
      <div class="compliments-zone" id="complimentsZone">
        <p class="message" id="message" aria-live="polite"></p>
      </div>
      <div class="buttons">
        <button id="yesBtn" type="button">–î–∞</button>
      </div>
    </main>
  </div>

  <button id="noBtn" type="button">–ù–µ—Ç</button>
  <button id="yesBtn2" type="button">–î–∞</button>

  <div class="popup" id="popup">
    –ù–∞–∂–º–∏ –¥–∞
  </div>

  <script>
   const compliments = [
  "–¢—ã ‚Äî –ø—Ä–∏—á–∏–Ω–∞, –ø–æ –∫–æ—Ç–æ—Ä–æ–π –º–∏—Ä –∫–∞–∂–µ—Ç—Å—è –ª—É—á—à–µ.",
  "–° —Ç–æ–±–æ–π –≤—Å—ë —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –ø—Ä–æ—â–µ –∏ —Ç–µ–ø–ª–µ–µ.",
  "–¢—ã –≤–¥–æ—Ö–Ω–æ–≤–ª—è–µ—à—å –º–µ–Ω—è –±—ã—Ç—å –ª—É—á—à–µ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å.",
  "–¢–≤–æ—è –¥–æ–±—Ä–æ—Ç–∞ –¥–µ–ª–∞–µ—Ç —ç—Ç–æ—Ç –º–∏—Ä —Å–≤–µ—Ç–ª–µ–µ.",
  "–¢—ã ‚Äî –º–æ—è —Å–∞–º–∞—è –∫—Ä–∞—Å–∏–≤–∞—è –º—ã—Å–ª—å.",
  "–° —Ç–æ–±–æ–π –¥–∞–∂–µ —Ç–∏—à–∏–Ω–∞ —É—é—Ç–Ω–∞—è.",
  "–¢—ã —É–º–µ–µ—à—å –¥–µ–ª–∞—Ç—å —Å—á–∞—Å—Ç–ª–∏–≤—ã–º–∏ –≤—Å–µ—Ö –≤–æ–∫—Ä—É–≥.",
  "–¢—ã ‚Äî –º–æ—ë —Å–∞–º–æ–µ –ø—Ä–∏—è—Ç–Ω–æ–µ —á—É–¥–æ.",
  "–¢–≤–æ—è —ç–Ω–µ—Ä–≥–∏—è –Ω–∞–ø–æ–ª–Ω—è–µ—Ç –≤—Å—ë –≤–æ–∫—Ä—É–≥.",
  "–¢—ã ‚Äî –ª—É—á—à–µ–µ, —á—Ç–æ —Å–æ –º–Ω–æ–π —Å–ª—É—á–∞–ª–æ—Å—å.",

  "–¢–≤–æ–π —Å–º–µ—Ö ‚Äî –º–æ—è –ª—é–±–∏–º–∞—è –º–µ–ª–æ–¥–∏—è.",
  "–¢—ã –¥–µ–ª–∞–µ—à—å —ç—Ç–æ—Ç –º–∏—Ä –º—è–≥—á–µ –∏ –¥–æ–±—Ä–µ–µ.",
  "–†—è–¥–æ–º —Å —Ç–æ–±–æ–π —Ö–æ—á–µ—Ç—Å—è —É–ª—ã–±–∞—Ç—å—Å—è —á–∞—â–µ.",
  "–¢—ã ‚Äî –º–æ—ë —Å–ø–æ–∫–æ–π—Å—Ç–≤–∏–µ –∏ —Ä–∞–¥–æ—Å—Ç—å.",
  "–¢—ã ‚Äî –Ω–∞—Å—Ç–æ—è—â–µ–µ —Å–æ–∫—Ä–æ–≤–∏—â–µ.",
  "–° —Ç–æ–±–æ–π –∫–∞–∂–¥—ã–π –¥–µ–Ω—å ‚Äî –ø–æ–¥–∞—Ä–æ–∫.",
  "–¢—ã –¥–µ–ª–∞–µ—à—å –º–æ—é –∂–∏–∑–Ω—å —è—Ä—á–µ.",
  "–¢—ã ‚Äî –º–æ–π –∏—Å—Ç–æ—á–Ω–∏–∫ –≤–¥–æ—Ö–Ω–æ–≤–µ–Ω–∏—è.",
  "–¢–≤–æ—ë –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–∏–µ ‚Äî –ª—É—á—à–µ–µ –ª–µ–∫–∞—Ä—Å—Ç–≤–æ.",
  "–¢—ã ‚Äî –º–æ–π —Å–∞–º—ã–π —Ç—ë–ø–ª—ã–π —á–µ–ª–æ–≤–µ–∫.",

  "–¢—ã —É–º–µ–µ—à—å –ø—Ä–µ–≤—Ä–∞—â–∞—Ç—å –æ–±—ã—á–Ω–æ–µ –≤ –≤–æ–ª—à–µ–±–Ω–æ–µ.",
  "–¢—ã ‚Äî –º–æ–π —Å–∞–º—ã–π –∫—Ä–∞—Å–∏–≤—ã–π —Å–æ–Ω –Ω–∞—è–≤—É.",
  "–¢–≤–æ—è –∑–∞–±–æ—Ç–∞ –±–µ—Å—Ü–µ–Ω–Ω–∞.",
  "–¢—ã –¥–µ–ª–∞–µ—à—å –¥–∞–∂–µ —Ç—Ä—É–¥–Ω—ã–µ –¥–Ω–∏ –ª–µ–≥—á–µ.",
  "–¢—ã ‚Äî –º–æ–π –ª–∏—á–Ω—ã–π –ª—É—á–∏–∫ —Å–≤–µ—Ç–∞.",
  "–° —Ç–æ–±–æ–π —Ö–æ—á–µ—Ç—Å—è —Å—Ç—Ä–æ–∏—Ç—å –º–µ—á—Ç—ã.",
  "–¢—ã ‚Äî –º–æ—ë —Å—á–∞—Å—Ç—å–µ –±–µ–∑ —É—Å–ª–æ–≤–∏–π.",
  "–¢—ã –Ω–∞–ø–æ–ª–Ω—è–µ—à—å –º–æ—ë —Å–µ—Ä–¥—Ü–µ —Ç–µ–ø–ª–æ–º.",
  "–¢—ã ‚Äî –º–æ–π –ª—é–±–∏–º—ã–π —Å—é—Ä–ø—Ä–∏–∑ –æ—Ç –∂–∏–∑–Ω–∏.",
  "–¢—ã ‚Äî –º–æ—è —Å–∞–º–∞—è –±–æ–ª—å—à–∞—è —Ä–∞–¥–æ—Å—Ç—å.",

  "–¢–≤–æ–π –≥–æ–ª–æ—Å —É—Å–ø–æ–∫–∞–∏–≤–∞–µ—Ç –ª—É—á—à–µ –º—É–∑—ã–∫–∏.",
  "–¢—ã ‚Äî –º–æ—ë –≤–¥–æ—Ö–Ω–æ–≤–µ–Ω–∏–µ –Ω–∞–≤—Å–µ–≥–¥–∞.",
  "–° —Ç–æ–±–æ–π –≤—Å—ë –∫–∞–∂–µ—Ç—Å—è –≤–æ–∑–º–æ–∂–Ω—ã–º.",
  "–¢—ã ‚Äî –º–æ–π —Å–∞–º—ã–π —Å–≤–µ—Ç–ª—ã–π —á–µ–ª–æ–≤–µ–∫.",
  "–¢—ã –¥–µ–ª–∞–µ—à—å –º–µ–Ω—è —Å—á–∞—Å—Ç–ª–∏–≤–µ–µ –ø—Ä–æ—Å—Ç–æ —Ç–µ–º, —á—Ç–æ –µ—Å—Ç—å.",
  "–¢—ã ‚Äî –º–æ—ë –º–∞–ª–µ–Ω—å–∫–æ–µ —á—É–¥–æ.",
  "–¢–≤–æ—è –Ω–µ–∂–Ω–æ—Å—Ç—å –±–µ—Å—Ü–µ–Ω–Ω–∞.",
  "–¢—ã ‚Äî –º–æ–π —Å–∞–º—ã–π –¥–æ—Ä–æ–≥–æ–π –ø–æ–¥–∞—Ä–æ–∫.",
  "–¢—ã –¥–µ–ª–∞–µ—à—å –º–æ—é –¥—É—à—É —Å–ø–æ–∫–æ–π–Ω–æ–π.",
  "–¢—ã ‚Äî –º–æ—ë —Å–∞–º–æ–µ —Ç—ë–ø–ª–æ–µ —á—É–≤—Å—Ç–≤–æ."
];

    const yesBtn = document.getElementById("yesBtn");
    const yesBtn2 = document.getElementById("yesBtn2");
    const noBtn = document.getElementById("noBtn");
    const message = document.getElementById("message");
    const heartsLayer = document.getElementById("heartsLayer");
    const effectsCanvas = document.getElementById("effectsCanvas");
    const heading = document.querySelector("h1");
    const popup = document.getElementById("popup");
    const photoRing = document.getElementById("photoRing");

    let complimentIndex = 0;
    let noButtonEscaped = false;
    let isFirstClick = true;
    let noButtonMoveCount = 0;
    let noButtonOldPosition = null;
    let photosAreRendered = false;
    let autoComplimentInterval = null;
    const maxButtonScale = 0.5;
    const maxOrbitingPhotos = 14;
    const effectsCtx = effectsCanvas.getContext("2d");
    const activeParticles = [];
    let effectsDpr = 1;
    let lastEffectsTs = performance.now();

    function resizeEffectsCanvas() {
      effectsDpr = window.devicePixelRatio || 1;
      const width = window.innerWidth;
      const height = window.innerHeight;
      effectsCanvas.width = Math.floor(width * effectsDpr);
      effectsCanvas.height = Math.floor(height * effectsDpr);
      effectsCanvas.style.width = `${width}px`;
      effectsCanvas.style.height = `${height}px`;
      effectsCtx.setTransform(effectsDpr, 0, 0, effectsDpr, 0, 0);
    }

    function spawnCanvasParticles(originX, originY, count, options) {
      const {
        colors,
        sizeMin,
        sizeMax,
        speedMin,
        speedMax,
        drag,
        gravity,
        lifeMin,
        lifeMax,
        circleChance
      } = options;

      for (let i = 0; i < count; i += 1) {
        const angle = Math.random() * Math.PI * 2;
        const speed = speedMin + Math.random() * (speedMax - speedMin);
        const life = lifeMin + Math.random() * (lifeMax - lifeMin);
        activeParticles.push({
          x: originX,
          y: originY,
          vx: Math.cos(angle) * speed,
          vy: Math.sin(angle) * speed,
          drag,
          gravity,
          rotation: Math.random() * Math.PI * 2,
          rotationSpeed: (-0.16 + Math.random() * 0.32),
          life,
          maxLife: life,
          size: sizeMin + Math.random() * (sizeMax - sizeMin),
          color: colors[Math.floor(Math.random() * colors.length)],
          shape: Math.random() < circleChance ? "circle" : "square"
        });
      }
    }

    function renderEffects(ts) {
      const dt = Math.min((ts - lastEffectsTs) / 16.6667, 2);
      lastEffectsTs = ts;

      effectsCtx.clearRect(0, 0, effectsCanvas.width, effectsCanvas.height);
      for (let i = activeParticles.length - 1; i >= 0; i -= 1) {
        const p = activeParticles[i];
        p.life -= dt;
        if (p.life <= 0) {
          activeParticles.splice(i, 1);
          continue;
        }

        p.vx *= Math.pow(p.drag, dt);
        p.vy = p.vy * Math.pow(p.drag, dt) + p.gravity * dt;
        p.x += p.vx * dt;
        p.y += p.vy * dt;
        p.rotation += p.rotationSpeed * dt;

        const alpha = Math.max(0, p.life / p.maxLife);
        effectsCtx.globalAlpha = alpha;
        effectsCtx.fillStyle = p.color;
        effectsCtx.save();
        effectsCtx.translate(p.x, p.y);
        effectsCtx.rotate(p.rotation);
        if (p.shape === "circle") {
          effectsCtx.beginPath();
          effectsCtx.arc(0, 0, p.size * 0.5, 0, Math.PI * 2);
          effectsCtx.fill();
        } else {
          effectsCtx.fillRect(-p.size * 0.5, -p.size * 0.5, p.size, p.size);
        }
        effectsCtx.restore();
      }
      effectsCtx.globalAlpha = 1;
      requestAnimationFrame(renderEffects);
    }

    resizeEffectsCanvas();
    window.addEventListener("resize", resizeEffectsCanvas);
    requestAnimationFrame(renderEffects);

    function shuffleInPlace(arr) {
      for (let i = arr.length - 1; i > 0; i -= 1) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
    }

    function showNextCompliment() {
      if (isFirstClick) {
        isFirstClick = false;
        heading.textContent = "–Ø —Ç–µ–±—è –ª—é–±–ª—é, –ë—É—Å—è";
        heading.style.transition = "opacity 0.3s ease";
        heading.style.opacity = "0";
        setTimeout(() => {
          heading.style.opacity = "1";
        }, 50);

        // Remove accept buttons after the first accept and switch to autoplay compliments.
        yesBtn.style.display = "none";
        yesBtn.style.pointerEvents = "none";
        yesBtn2.style.display = "none";
        yesBtn2.style.pointerEvents = "none";

        noBtn.style.opacity = "0";
        noBtn.style.visibility = "hidden";
        noBtn.style.pointerEvents = "none";
        hideSecondYesButton();
        startAutoCompliments();
      }
      showPhotosAroundCompliments();

      if (complimentIndex === 0) {
        shuffleInPlace(compliments);
      }

      createConfetti();
      if (photoRing.classList.contains("show")) {
        triggerPhotosJump();
        createConfetti();
      }

      message.classList.remove("show");
      const text = compliments[complimentIndex];
      complimentIndex = (complimentIndex + 1) % compliments.length;

      setTimeout(() => {
        message.textContent = text;
        message.classList.add("show");
      }, 70);
    }

    function startAutoCompliments() {
      if (autoComplimentInterval) return;
      autoComplimentInterval = setInterval(() => {
        showNextCompliment();
      }, 3000);
    }

    function preloadImage(url) {
      return new Promise((resolve) => {
        const image = new Image();
        image.onload = () => resolve(url);
        image.onerror = () => resolve(null);
        image.src = url;
      });
    }

    async function loadPhotosFromImageFolder() {
      try {
        const response = await fetch("image/photos.json", { cache: "no-store" });
        if (response.ok) {
          const list = await response.json();
          if (Array.isArray(list) && list.length) {
            const urls = list.map((fileName) =>
              String(fileName).startsWith("image/") ? String(fileName) : `image/${String(fileName)}`
            );
            const verified = await Promise.all(urls.map(preloadImage));
            return verified.filter(Boolean);
          }
        }
      } catch (e) {}

      const guessedFiles = [];
      const commonPrefixes = ["photo", "img", "image"];
      const commonExts = ["jpg", "jpeg", "png", "webp"];
      for (let number = 1; number <= 12; number += 1) {
        guessedFiles.push(`image/${number}.jpg`, `image/${number}.png`);
        for (const prefix of commonPrefixes) {
          for (const ext of commonExts) {
            guessedFiles.push(`image/${prefix}${number}.${ext}`);
          }
        }
      }
      const checked = await Promise.all(guessedFiles.map(preloadImage));
      return checked.filter(Boolean);
    }

    const flyAnimations = [
      { name: "flyLeftToRight", setStart: (el) => { el.style.top = `${15 + Math.random() * 70}vh`; el.style.left = "-100px"; } },
      { name: "flyRightToLeft", setStart: (el) => { el.style.top = `${15 + Math.random() * 70}vh`; el.style.left = "100vw"; } },
      { name: "flyTopToBottom", setStart: (el) => { el.style.left = `${10 + Math.random() * 80}vw`; el.style.top = "-100px"; } },
      { name: "flyBottomToTop", setStart: (el) => { el.style.left = `${10 + Math.random() * 80}vw`; el.style.top = "100vh"; } },
      { name: "flyTopLeftToBottomRight", setStart: (el) => { el.style.left = "-100px"; el.style.top = "-100px"; } },
      { name: "flyTopRightToBottomLeft", setStart: (el) => { el.style.left = "100vw"; el.style.top = "-100px"; } },
      { name: "flyBottomLeftToTopRight", setStart: (el) => { el.style.left = "-100px"; el.style.top = "100vh"; } },
      { name: "flyBottomRightToTopLeft", setStart: (el) => { el.style.left = "100vw"; el.style.top = "100vh"; } }
    ];

    function renderPhotoRing(urls) {
      if (!urls.length) return;
      const expanded = [];
      for (let rep = 0; rep < 3; rep++) expanded.push(...urls);
      shuffleInPlace(expanded);
      const dirs = [...flyAnimations];
      shuffleInPlace(dirs);
      photoRing.textContent = "";
      const slice = expanded.slice(0, maxOrbitingPhotos);
      slice.forEach((url, index) => {
        const frame = document.createElement("figure");
        frame.className = "photo-item";
        const fly = dirs[index % dirs.length];
        fly.setStart(frame);
        const duration = 6 + Math.random() * 5;
        const delay = -Math.random() * duration;
        frame.style.animation = `${fly.name} ${duration}s linear ${delay}s infinite`;
        frame.style.marginLeft = "-40px";
        frame.style.marginTop = "-40px";

        const inner = document.createElement("div");
        inner.className = "photo-item-inner";
        const img = document.createElement("img");
        img.src = url;
        img.alt = "";
        inner.appendChild(img);
        frame.appendChild(inner);

        const heartsWrap = document.createElement("div");
        heartsWrap.className = "photo-hearts";
        const heartSymbols = ["‚ù§", "üíñ", "üíó", "üíï", "üíû", "‚ù§", "üíñ", "üíó", "üíï", "üíû"];
        heartSymbols.forEach((symbol, i) => {
          const orbit = document.createElement("div");
          orbit.className = "photo-heart-orbit" + (i >= 5 ? " photo-heart-outer" : "");
          const h = document.createElement("span");
          h.className = "photo-heart";
          h.textContent = symbol;
          orbit.appendChild(h);
          heartsWrap.appendChild(orbit);
        });
        frame.appendChild(heartsWrap);

        photoRing.appendChild(frame);
      });
      photoRing.classList.add("show");
      photosAreRendered = true;
    }

    async function showPhotosAroundCompliments() {
      if (photosAreRendered) return;
      const imageUrls = await loadPhotosFromImageFolder();
      if (imageUrls.length) {
        renderPhotoRing(imageUrls);
      }
    }

    function randomPositionForNoButton() {
      const padding = 14;
      const rect = noBtn.getBoundingClientRect();
      const buttonWidth = rect.width;
      const buttonHeight = rect.height;
      
      // –ü–æ–ª—É—á–∞–µ–º –ø–æ–∑–∏—Ü–∏–∏ –∫–∞—Ä—Ç–æ—á–∫–∏ –∏ –ø–æ–ø–∞–ø–∞
      const card = document.querySelector(".card");
      const popup = document.getElementById("popup");
      const cardRect = card ? card.getBoundingClientRect() : null;
      const popupRect = popup && popup.classList.contains("show") ? popup.getBoundingClientRect() : null;
      
      let x, y;
      let attempts = 0;
      const maxAttempts = 50;
      
      do {
        const maxX = window.innerWidth - buttonWidth - padding;
        const maxY = window.innerHeight - buttonHeight - padding;
        x = Math.max(padding, Math.floor(Math.random() * Math.max(padding, maxX)));
        y = Math.max(padding, Math.floor(Math.random() * Math.max(padding, maxY)));
        
        attempts += 1;
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –ø–µ—Ä–µ—Å–µ–∫–∞–µ—Ç—Å—è –ª–∏ –ø–æ–∑–∏—Ü–∏—è —Å –∫–∞—Ä—Ç–æ—á–∫–æ–π
        let overlapsCard = false;
        if (cardRect) {
          const buttonRight = x + buttonWidth;
          const buttonBottom = y + buttonHeight;
          const cardRight = cardRect.right + padding;
          const cardBottom = cardRect.bottom + padding;
          const cardLeft = cardRect.left - padding;
          const cardTop = cardRect.top - padding;
          
          overlapsCard = !(buttonRight < cardLeft || x > cardRight || buttonBottom < cardTop || y > cardBottom);
        }
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –ø–µ—Ä–µ—Å–µ–∫–∞–µ—Ç—Å—è –ª–∏ –ø–æ–∑–∏—Ü–∏—è —Å –ø–æ–ø–∞–ø–æ–º
        let overlapsPopup = false;
        if (popupRect) {
          const buttonRight = x + buttonWidth;
          const buttonBottom = y + buttonHeight;
          const popupRight = popupRect.right + padding;
          const popupBottom = popupRect.bottom + padding;
          const popupLeft = popupRect.left - padding;
          const popupTop = popupRect.top - padding;
          
          overlapsPopup = !(buttonRight < popupLeft || x > popupRight || buttonBottom < popupTop || y > popupBottom);
        }
        
        // –ï—Å–ª–∏ –Ω–µ –ø–µ—Ä–µ—Å–µ–∫–∞–µ—Ç—Å—è –Ω–∏ —Å –∫–∞—Ä—Ç–æ—á–∫–æ–π, –Ω–∏ —Å –ø–æ–ø–∞–ø–æ–º, –≤—ã—Ö–æ–¥–∏–º –∏–∑ —Ü–∏–∫–ª–∞
        if (!overlapsCard && !overlapsPopup) {
          break;
        }
      } while (attempts < maxAttempts);
      
      return { x, y };
    }

    function positionNoButtonNextToYes() {
      const padding = 14;
      const gap = 12;
      const yesRect = yesBtn.getBoundingClientRect();
      const noRect = noBtn.getBoundingClientRect();

      const desiredX = yesRect.right + gap;
      const desiredY = yesRect.top + (yesRect.height - noRect.height) / 2;

      const x = Math.min(
        window.innerWidth - noRect.width - padding,
        Math.max(padding, desiredX)
      );
      const y = Math.min(
        window.innerHeight - noRect.height - padding,
        Math.max(padding, desiredY)
      );

      noBtn.style.left = `${x}px`;
      noBtn.style.top = `${y}px`;
      noBtn.style.visibility = "visible";
    }

    function moveNoButton() {
      noButtonEscaped = true;
      
      // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â—É—é –ø–æ–∑–∏—Ü–∏—é –∫–Ω–æ–ø–∫–∏ "–ù–µ—Ç" –ü–ï–†–ï–î –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ–º (–Ω–∞—á–∏–Ω–∞—è —Å 3-–≥–æ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è)
      let previousPosition = null;
      if (noButtonMoveCount >= 2 && isFirstClick) {
        const currentRect = noBtn.getBoundingClientRect();
        previousPosition = {
          left: currentRect.left,
          top: currentRect.top,
          width: currentRect.width,
          height: currentRect.height
        };
      }
      
      noButtonMoveCount += 1;
      
      // –ï—Å–ª–∏ —ç—Ç–æ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –ø–æ—Å–ª–µ 3-–≥–æ, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Ç–æ—Ä—É—é –∫–Ω–æ–ø–∫—É "–î–∞" –Ω–∞ —Å—Ç–∞—Ä–æ–º –º–µ—Å—Ç–µ
      if (noButtonMoveCount >= 3 && isFirstClick && previousPosition) {
        // –°–∫—Ä—ã–≤–∞–µ–º —Å—Ç–∞—Ä—É—é –≤—Ç–æ—Ä—É—é –∫–Ω–æ–ø–∫—É "–î–∞" –µ—Å–ª–∏ –æ–Ω–∞ –±—ã–ª–∞ –≤–∏–¥–Ω–∞
        hideSecondYesButton();
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω–æ–≤—É—é –≤—Ç–æ—Ä—É—é –∫–Ω–æ–ø–∫—É "–î–∞" –Ω–∞ –ø—Ä–µ–¥—ã–¥—É—â–µ–π –ø–æ–∑–∏—Ü–∏–∏ —Å—Ä–∞–∑—É
        showSecondYesButtonAtPosition(previousPosition);
      }
      
      noBtn.classList.remove("teleport-in");
      noBtn.classList.add("teleport-out");

      setTimeout(() => {
        const { x, y } = randomPositionForNoButton();
        noBtn.style.left = `${x}px`;
        noBtn.style.top = `${y}px`;
        noBtn.classList.remove("teleport-out");
        noBtn.classList.add("teleport-in");
      }, 400);

      if (noButtonMoveCount >= 3 && isFirstClick) {
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Å–ø–ª—ã–≤–∞—é—â–µ–µ –æ–∫–Ω–æ –ø—Ä–∏ –∫–∞–∂–¥–æ–º –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–∏ –ø–æ—Å–ª–µ 3-–≥–æ
        showPopup();
        
        if (noButtonMoveCount === 3) {
          // –ü—Ä–∏ –ø–µ—Ä–≤–æ–º –ø–æ—è–≤–ª–µ–Ω–∏–∏ —Å–æ—Ö—Ä–∞–Ω—è–µ–º –ø–æ–∑–∏—Ü–∏—é –¥–ª—è –≤—Ç–æ—Ä–æ–π –∫–Ω–æ–ø–∫–∏
          if (previousPosition) {
            noButtonOldPosition = previousPosition;
          }
        } else {
          increaseYesButton();
        }
      }
    }

    function increaseYesButton() {
      if (!isFirstClick) return;
      
      const baseWidth = yesBtn.getBoundingClientRect().width || 100;
      const screenWidth = window.innerWidth;
      const maxWidth = screenWidth * maxButtonScale;
      
      const currentTransform = yesBtn.style.transform || "scale(1)";
      const currentScaleMatch = currentTransform.match(/scale\(([\d.]+)\)/);
      const currentScale = currentScaleMatch ? parseFloat(currentScaleMatch[1]) : 1;
      
      const increment = 0.2;
      const newScale = Math.min(currentScale + increment, maxWidth / baseWidth);
      
      const fontSize = Math.min(1 + (newScale - 1) * 0.25, 2.5);
      const paddingMultiplier = 1 + (newScale - 1) * 0.25;
      
      yesBtn.style.transform = `scale(${newScale})`;
      yesBtn.style.fontSize = `${fontSize}rem`;
      yesBtn.style.padding = `${0.85 * paddingMultiplier}rem ${1.7 * paddingMultiplier}rem`;
      yesBtn.style.boxShadow = `0 ${8 + (newScale - 1) * 20}px ${16 + (newScale - 1) * 30}px rgba(255, 79, 135, ${Math.min(0.12 + (newScale - 1) * 0.3, 0.6)})`;
      yesBtn.classList.add("bigger");
    }

    function showSecondYesButton() {
      if (!isFirstClick || !noButtonOldPosition) return;
      showSecondYesButtonAtPosition(noButtonOldPosition);
    }

    function showSecondYesButtonAtPosition(position) {
      if (!isFirstClick || !position) return;
      
      yesBtn2.style.left = `${position.left}px`;
      yesBtn2.style.top = `${position.top}px`;
      yesBtn2.style.width = `${position.width}px`;
      yesBtn2.style.height = `${position.height}px`;
      yesBtn2.classList.add("show");
    }

    function hideSecondYesButton() {
      yesBtn2.classList.remove("show");
    }

    function showPopup() {
      popup.classList.add("show");
      yesBtn.classList.add("bigger");
      
      setTimeout(() => {
        hidePopup();
      }, 1000);
    }

    function hidePopup() {
      popup.classList.remove("show");
    }

    function resetFirstButtonSize() {
      yesBtn.style.transform = "scale(1)";
      yesBtn.style.fontSize = "1rem";
      yesBtn.style.padding = "0.85rem 1.7rem";
      yesBtn.style.boxShadow = "0 8px 16px rgba(0, 0, 0, 0.12)";
      yesBtn.classList.remove("bigger");
    }

    function handleYesClick() {
      hidePopup();
      resetFirstButtonSize();
      hideSecondYesButton();
      showNextCompliment();
    }

    function handleSecondYesClick() {
      hidePopup();
      resetFirstButtonSize();
      hideSecondYesButton();
      showNextCompliment();
    }

    yesBtn.addEventListener("click", handleYesClick);
    yesBtn2.addEventListener("click", handleSecondYesClick);

    const heartSymbols = ["‚ù§", "üíñ", "üíó", "üíï"];

    function createHeart() {
      if (heartsLayer.childElementCount > 60) {
        heartsLayer.removeChild(heartsLayer.firstChild);
      }

      const heart = document.createElement("span");
      const r = Math.random();
      heart.className = "heart" + (r < 0.25 ? " heart-small" : r > 0.75 ? " heart-big" : "");
      heart.textContent = heartSymbols[Math.floor(Math.random() * heartSymbols.length)];
      heart.style.left = `${Math.random() * 100}vw`;
      heart.style.top = `${Math.random() * 100}vh`;
      heart.style.animationDuration = `${7 + Math.random() * 9}s`;
      heart.style.setProperty("--hx", `${-90 + Math.random() * 180}px`);
      heart.style.setProperty("--hy", `${-120 + Math.random() * 240}px`);
      heart.style.fontSize = heart.classList.contains("heart-small") ? "1rem" : heart.classList.contains("heart-big") ? "2rem" : `${1.1 + Math.random() * 1.2}rem`;
      heartsLayer.appendChild(heart);
      setTimeout(() => heart.remove(), 14000);
    }

    function createPinkParticlesAt(centerX, centerY) {
      spawnCanvasParticles(centerX, centerY, 36, {
        colors: ["#ff69b4", "#ff95bf", "#ff1493", "#ffb6d9"],
        sizeMin: 3,
        sizeMax: 9,
        speedMin: 1.6,
        speedMax: 6.8,
        drag: 0.966,
        gravity: 0.05,
        lifeMin: 24,
        lifeMax: 46,
        circleChance: 0.9
      });
    }

    function triggerPhotosJump() {
      const items = document.querySelectorAll(".photo-item");
      const inners = document.querySelectorAll(".photo-item-inner");
      inners.forEach((el) => el.classList.add("photo-jump"));
      setTimeout(() => {
        inners.forEach((el) => el.classList.remove("photo-jump"));
        const rects = [];
        items.forEach((el) => {
          rects.push(el.getBoundingClientRect());
        });
        rects.forEach((r) => {
          const cx = r.left + r.width / 2;
          const cy = r.top + r.height / 2;
          createPinkParticlesAt(cx, cy);
        });
      }, 560);
    }

    function createConfetti() {
      const duration = 1200;
      const targets = [];

      const card = document.querySelector(".card");
      if (card) {
        const cardRect = card.getBoundingClientRect();
        targets.push({
          x: cardRect.left + cardRect.width / 2,
          y: cardRect.top + cardRect.height / 2,
          count: 120
        });
      }

      const photos = document.querySelectorAll(".photo-item");
      const photoRects = [];
      photos.forEach((photo) => {
        photoRects.push(photo.getBoundingClientRect());
      });
      photoRects.forEach((rect) => {
        targets.push({
          x: rect.left + rect.width / 2,
          y: rect.top + rect.height / 2,
          count: 18
        });
      });

      if (!targets.length) {
        targets.push({ x: window.innerWidth / 2, y: window.innerHeight / 2, count: 120 });
      }

      targets.forEach((target) => {
        spawnCanvasParticles(target.x, target.y, target.count, {
          colors: ["#ff4f87", "#ff2f75", "#ff69b4", "#ff1493", "#ffb6c1", "#ffffff"],
          sizeMin: 4,
          sizeMax: 11,
          speedMin: 1.2,
          speedMax: 8.2,
          drag: 0.972,
          gravity: 0.11,
          lifeMin: duration / 28,
          lifeMax: (duration + 500) / 24,
          circleChance: 0.35
        });
      });
    }

    noBtn.addEventListener("mouseenter", moveNoButton);
    noBtn.addEventListener("touchstart", (event) => {
      event.preventDefault();
      moveNoButton();
    }, { passive: false });
    noBtn.addEventListener("click", (event) => {
      event.preventDefault();
      moveNoButton();
    });

    window.addEventListener("resize", () => {
      if (!isFirstClick) return;
      if (noButtonEscaped) {
        const { x, y } = randomPositionForNoButton();
        noBtn.style.left = `${x}px`;
        noBtn.style.top = `${y}px`;
        return;
      }
      positionNoButtonNextToYes();
    });

    for (let i = 0; i < 42; i += 1) {
      setTimeout(createHeart, i * 100);
    }
    positionNoButtonNextToYes();
    setInterval(createHeart, 800);
  </script>
</body>
</html>
